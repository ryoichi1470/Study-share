<h1 class="text-center my-0" style="background-color: #001f3f; color: white;">投稿詳細</h1>

<div class="container-fluid min-vh-80 d-flex flex-column justify-content-center">
  <div class="row flex-grow-1">
    <div class="col-md-4 text-center">
      <%= image_tag 'uchino_6270000036_TP_V4.jpg', alt: '左の画像', class: 'img-fluid', style: 'opacity: 0.3;' %>
    </div>

    <div class="col-md-4">
      <div class="post-detail mt-5">
        <h4 class="form-label">タイトル</h4>
        <p><%= @post.title %></p>

        <h4 class="form-label mt-3">テキスト</h4>
        <p><%= @post.text %></p>

        <h4 class="form-label mt-3">投稿者</h4>
        <p class="text-muted">
          投稿者: <%= link_to @post.user.name, user_mypage_path(@post.user.id), class: 'text-muted' %> 
        </p>
      </div>

      <h2 class="mt-4">コメント</h2>

      <% if !current_user.guest? %>
        <%= form_with(model: [@post, @post.comments.build], local: true, url: users_post_comments_path(@post)) do |form| %>
          <div class="form-group">
            <%= form.text_area :content, rows: 4, class: "form-control", placeholder: "コメントを入力してください" %>
          </div>
          <%= form.submit "コメントを投稿する", class: "btn btn-primary" %>
        <% end %>
      <% else %>
        <p class="text-danger">ゲストユーザーはコメントを投稿できません。</p>
      <% end %>
      
     <div class="comments mt-4">
        <% @post.comments.each do |comment| %>
          <% if comment.id.present? %> 
            <div class="comment border rounded p-2 mb-2">
              <strong><%= comment.user.present? ? comment.user.name : '匿名ユーザー' %></strong>
              <p><%= comment.content %></p>
              <% if comment.user == current_user && !current_user.guest? %>
                <%= link_to '編集', edit_users_post_comment_path(@post, comment) %>
                <%= link_to '削除', users_post_comment_path(@post, comment), method: :delete, data: { confirm: '本当に削除しますか？' } %>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>

      <div class="text-center mt-5">
        <% if @post.user == current_user %> 
          <%= link_to '編集', edit_users_post_path(@post), class: "btn btn-warning" %>
          <%= link_to '削除', users_post_path(@post), method: :delete, data: { confirm: '本当に削除しますか？' }, class: "btn btn-danger" %>
        <% end %>
        <%= link_to '戻る', users_posts_path, class: "btn btn-secondary" %>
      </div>

      <% if flash[:notice] %>
        <div class="alert alert-success mt-4 text-center">
          <%= flash[:notice] %>
        </div>
      <% end %>
    </div>

    <div class="col-md-4 text-center">
      <%= image_tag 'uchino_6270000036_TP_V4.jpg', alt: '右の画像', class: 'img-fluid', style: 'opacity: 0.3;' %>
    </div>
  </div>
</div>
